<h2 id="중간-점검">중간 점검</h2>

<ul>
  <li>SideBar 추가</li>
</ul>

<p><img src="/assets/img/ingyeo/3/Untitled.png" alt="Untitled" /></p>

<ul>
  <li>Toast 추가
    <ul>
      <li><a href="https://github.com/ankurk91/vue-toast-notification">vue-toast-notification</a> 사용</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/img/ingyeo/3/Screen_Shot_2022-03-14_at_8.20.14_PM.png" alt="Screen Shot 2022-03-14 at 8.20.14 PM.png" /></p>

<ul>
  <li>복무 기간 페이지 (’/army’) 완성
    <ul>
      <li><a href="https://github.com/victorgarciaesgi/vue-chart-3">vue-chart-3</a> 사용</li>
      <li><a href="https://github.com/apertureless/vue-chartjs">vue-chartjs</a>를 사용하려 했으나 vue 3 를 지원하지 않는 관계로 feature가 적으나 호환이 되는 vue-chart-3를 선택</li>
    </ul>
  </li>
</ul>

<p><img src="/assets/img/ingyeo/3/Untitled%201.png" alt="Untitled" /></p>

<ul>
  <li>로그인 페이지 구현</li>
</ul>

<p><img src="/assets/img/ingyeo/3/Untitled%202.png" alt="Untitled" /></p>

<h2 id="백엔드-개발">백엔드 개발</h2>

<p>백엔드는 유일하게 사용할 줄 아는 django rest framework를 사용하기로 했다. 웹에서 새로운 걸 공부하기 위해 vue를 사용한 것과는 별개로 기존에 아는 것을 사용하기로 했는데 가장 큰 이유는 학습 곡선의 문제였다. 프론트가 html + js + css 의 큰 틀을 유지하면서 사용 방법만 차이가 있는 것과는 달리 백엔드 프레임워크들은 그 구성부터가 차이가 났기 때문이다. 따라서 새로운 프레임워크를 공부하며 개발을 하는 것 보다는 기존에 많이 사용해왔던 django를 사용하는 것이 더 효율적이라고 판단하였다.</p>

<p>가장 먼저 백엔드에서 진행했던 부분은 user 저장과 관련된 부분이었다. Username을 닉네임으로 사용하고자 했기 때문에 CustomUser을 만드는 방식을 채택했다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.base_user</span> <span class="kn">import</span> <span class="n">AbstractBaseUser</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">PermissionsMixin</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="kn">from</span> <span class="nn">.managers</span> <span class="kn">import</span> <span class="n">CustomUserManager</span>

<span class="k">class</span> <span class="nc">CustomUser</span><span class="p">(</span><span class="n">AbstractBaseUser</span><span class="p">,</span> <span class="n">PermissionsMixin</span><span class="p">):</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">introduction</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">is_active</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">is_staff</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">date_joined</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">timezone</span><span class="p">.</span><span class="n">now</span><span class="p">)</span>

    <span class="n">USERNAME_FIELD</span> <span class="o">=</span> <span class="s">'user_id'</span>
    <span class="n">REQUIRED_FIELDS</span> <span class="o">=</span> <span class="p">[</span><span class="s">'username'</span><span class="p">]</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">CustomUserManager</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s">'User </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">user_id</span><span class="si">}</span><span class="s">'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>위와 같이 <code class="language-plaintext highlighter-rouge">AbstractBaseUser</code>을 상속해서 <code class="language-plaintext highlighter-rouge">CustomUser</code> 클래스를 생성해주고, <code class="language-plaintext highlighter-rouge">admins.py</code>, <code class="language-plaintext highlighter-rouge">managers.py</code> 등 여러 파일을 적절히 수정한 뒤, <code class="language-plaintext highlighter-rouge">settings.py</code> 에서</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">AUTH_USER_MODEL</span> <span class="o">=</span> <span class="s">'user.CustomUser'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>와 같이 설정해주었다.</p>

<p>유저 인증 방식은 <a href="https://www.django-rest-framework.org/api-guide/authentication/#tokenauthentication">Token Authentication</a> 방식을 사용했다. 서버에서는 로그인 시, Response body에 token을 포함시켜서 response하면 되며, 클라이언트에서는 Request를 보낼 때 Header에 token을 포함시키는 방식으로 작동한다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Authorization: Token 9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b
</pre></td></tr></tbody></table></code></pre></div></div>

<p>이후 적절히 <code class="language-plaintext highlighter-rouge">views.py</code> 를 건드려서 로그인과 회원가입을 완성시켜 주었다.</p>

<h2 id="frontend--backend">Frontend + Backend</h2>

<p>이제 프론트엔드와 백엔드가 잘 연결되는지를 확인해볼 시간이다.</p>

<h3 id="proxy-설정">Proxy 설정</h3>

<p>먼저 Vue 선에서 proxy를 설정해주어야 하는데 기본적으로 vue 개발 서버에서 request를 보낼 때, 따로 설정하지 않으면 <code class="language-plaintext highlighter-rouge">localhost:8080</code>으로 request를 보내게 된다. 우리의 백엔드 서버는 <code class="language-plaintext highlighter-rouge">localhost:8000</code>에서 돌아가고 있으므로 vue project의 최상단에 <code class="language-plaintext highlighter-rouge">vue.config.js</code> 파일을 만들어 다음과 같이 설정해주었다.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">devServer</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
          <span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://127.0.0.1:8000</span><span class="dl">'</span>
          <span class="p">}</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>이와 같이 설정하면 클라이언트에서 api로 시작하는 요청이 <code class="language-plaintext highlighter-rouge">localhost:8080</code>이 아니라 <code class="language-plaintext highlighter-rouge">localhost:8000</code>으로 리다이렉트되어 요청된다.</p>

<h3 id="axios">axios</h3>

<p>통신을 위해서 axios를 사용하였다. axios는 vuex와 연동하여 그 구조를 깔끔하게 만들어줄 수 있다.</p>

<p>vuex는 크게 state, getters, mutations, actions로 나눌 수 있다. 통신의 control flow를 글로 적어보면, 첫 번째로 Vue의 Component에서 actions 내의 async fuction(axios 포함)을 dispatch 한다. 이 async function은 axios를 활용하여 통신을 진행하게 되고, 그 결과를 가지고 mutation 내의 function을 commit 한다. 이후 mutation 내의 function이 state를 변경하게 되는 것이다.</p>

<p>실제 코드를 통해 간단하게 살펴보면 다음과 같다.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="c1">// Login.vue</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Login</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">userId</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
      <span class="na">password</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">onClickLogin</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">userData</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">user_id</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">userId</span><span class="p">,</span>
        <span class="na">password</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="dl">'</span><span class="s1">user/login</span><span class="dl">'</span><span class="p">,</span> <span class="nx">userData</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">onClickLogin</code>에서 <code class="language-plaintext highlighter-rouge">userId</code>와 <code class="language-plaintext highlighter-rouge">password</code> 정보를 <code class="language-plaintext highlighter-rouge">userData</code>로 묶어주고, <code class="language-plaintext highlighter-rouge">dispatch</code>를 통해 action을 불러온다.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1">// store/user.js</span>
<span class="kd">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="k">async</span> <span class="nx">login</span><span class="p">({</span> <span class="nx">commit</span> <span class="p">},</span> <span class="nx">loginData</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">user/login/</span><span class="dl">'</span><span class="p">,</span> <span class="nx">loginData</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">userData</span> <span class="o">=</span> <span class="p">{</span>
          <span class="na">user_id</span><span class="p">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">user_id</span><span class="p">,</span>
          <span class="na">username</span><span class="p">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
          <span class="na">introduction</span><span class="p">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">introduction</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="nx">commit</span><span class="p">(</span><span class="dl">'</span><span class="s1">updateUserData</span><span class="dl">'</span><span class="p">,</span> <span class="nx">userData</span><span class="p">);</span>
        <span class="nx">commit</span><span class="p">(</span><span class="dl">'</span><span class="s1">updateAccessToken</span><span class="dl">'</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">token</span><span class="p">);</span>
      <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>이후 action은 axios를 통해 post request를 백엔드에 보내게 되고, 받은 result를 가지고 local storage에 있는 <code class="language-plaintext highlighter-rouge">userData</code>와 <code class="language-plaintext highlighter-rouge">accessToken</code>을 갱신시키는 mutation을 <code class="language-plaintext highlighter-rouge">commit</code>을 통해 불러온다.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c1">// store/user.js</span>
<span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">userData</span><span class="p">:</span> <span class="p">{},</span>
  <span class="na">accessToken</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">mutations</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">updateUserData</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">userData</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">userData</span> <span class="o">=</span> <span class="nx">userData</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">updateAccessToken</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">accessToken</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">accessToken</span> <span class="o">=</span> <span class="nx">accessToken</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>결과적으로 mutation이 state를 변경시키면서 login flow가 끝이 난다.</p>

<p>이후 이렇게 저장된 <code class="language-plaintext highlighter-rouge">userData</code>와 <code class="language-plaintext highlighter-rouge">accessToken</code>을 활용하여 원하는 기능을 구현하면 된다.</p>

<h3 id="결과">결과</h3>

<p><img src="/assets/img/ingyeo/3/Untitled%203.png" alt="Untitled" /></p>

<p>성공적으로 프론트엔드와 백엔드를 연결한 모습을 확인할 수 있다.</p>

<p>회원가입 페이지, 게시판 페이지 등 다양하게 할 일이 많이 남았다. 게시판부터 만든다고 해놓고 뭐가 이렇게 오래 걸리는지 모르겠다. 그래도 하나하나 새로운 것들을 배우며 진행하고 있기 때문에 큰 시간낭비라고 생각하진 않는다. 다음 게시물에선 진짜 게시판을 완성해야겠다…</p>
